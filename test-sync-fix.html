<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</title>
    <meta charset="utf-8">
</head>            });
            
            updateLocalDataDisplay();
        }
        
        function forceSync() {
            console.log('üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...');
            if (window.forcSyncFirebase) {
                window.forcSyncFirebase();
                console.log('‚úÖ –ö–æ–º–∞–Ω–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
            } else {
                console.log('‚ùå –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }
        
        function checkDeletedSync() {
            console.log('üóëÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π...');
            
            if (window.firebaseSync && window.firebaseSync.isInitialized) {
                const familyId = window.firebaseSync.getFamilyId();
                const deletedRef = window.firebaseSync.database.ref(`families/${familyId}/deletedTransactions`);
                
                deletedRef.once('value', (snapshot) => {
                    const firebaseDeleted = snapshot.val() || {};
                    console.log('‚òÅÔ∏è –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Firebase:', Object.keys(firebaseDeleted));
                    
                    const localDeleted = JSON.parse(localStorage.getItem('deletedTransactions') || '[]');
                    console.log('üì± –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ:', localDeleted);
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    window.firebaseSync.mergeDeletedTransactions(firebaseDeleted);
                    updateLocalDataDisplay();
                });
            } else {
                console.log('‚ùå Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞');
            }
        }dy>
    <h1>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ Firebase</h1>
    
    <div id="status" style="padding: 20px; background: #f0f0f0; margin: 10px 0;">
        <h3>–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <div id="test-results"></div>
    </div>
    
    <div style="margin: 20px 0;">
        <button onclick="runTests()" style="padding: 10px 20px; font-size: 16px;">üî¨ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
        <button onclick="clearAllData()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="addTestTransaction()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
        <button onclick="deleteTestTransaction()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">‚ùå –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
        <button onclick="forceSync()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
        <button onclick="checkDeletedSync()" style="padding: 10px 20px; font-size: 16px; margin-left: 10px;">üóëÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ</button>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</h3>
        <div id="local-data" style="background: #e8f4f8; padding: 10px; font-family: monospace; white-space: pre-wrap;"></div>
    </div>
    
    <div style="margin: 20px 0;">
        <h3>–ö–æ–Ω—Å–æ–ª—å:</h3>
        <div id="console-log" style="background: #2d3748; color: #e2e8f0; padding: 10px; font-family: monospace; white-space: pre-wrap; height: 300px; overflow-y: auto;"></div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Firebase Sync -->
    <script src="firebase-sync.js"></script>
    
    <script>
        let testTransactionId = null;
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function logToDiv(message, type = 'log') {
            const consoleDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : '#4ecdc4';
            consoleDiv.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logToDiv(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            logToDiv(args.join(' '), 'error');
        };
        
        function updateLocalDataDisplay() {
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            const deletedTransactions = JSON.parse(localStorage.getItem('deletedTransactions') || '[]');
            
            const dataDiv = document.getElementById('local-data');
            dataDiv.textContent = `–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (${transactions.length}):\n${JSON.stringify(transactions, null, 2)}\n\n–£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (${deletedTransactions.length}):\n${JSON.stringify(deletedTransactions, null, 2)}`;
        }
        
        function showTestResult(message, success = true) {
            const resultsDiv = document.getElementById('test-results');
            const color = success ? 'green' : 'red';
            const icon = success ? '‚úÖ' : '‚ùå';
            resultsDiv.innerHTML += `<div style="color: ${color}; margin: 5px 0;">${icon} ${message}</div>`;
        }
        
        async function runTests() {
            document.getElementById('test-results').innerHTML = '';
            console.log('üî¨ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...');
            
            try {
                // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Firebase
                if (window.firebaseSync && window.firebaseSync.isInitialized) {
                    showTestResult('Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                } else {
                    showTestResult('Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ù–ï –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞', false);
                    return;
                }
                
                // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                if (typeof window.firebaseSync.isDeleting !== 'undefined' && 
                    typeof window.firebaseSync.deletingTransactions !== 'undefined') {
                    showTestResult('–§–ª–∞–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                } else {
                    showTestResult('–§–ª–∞–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ù–ï –Ω–∞–π–¥–µ–Ω—ã', false);
                }
                
                // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥ deleteTransactionFromFirebase
                if (typeof window.deleteTransactionFromFirebase === 'function') {
                    showTestResult('–§—É–Ω–∫—Ü–∏—è deleteTransactionFromFirebase –¥–æ—Å—Ç—É–ø–Ω–∞');
                } else {
                    showTestResult('–§—É–Ω–∫—Ü–∏—è deleteTransactionFromFirebase –ù–ï –Ω–∞–π–¥–µ–Ω–∞', false);
                }
                
                // –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –≤ syncToFirebase
                const testStats = window.firebaseSync.getSyncStats();
                if (testStats) {
                    showTestResult(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ${JSON.stringify(testStats)}`);
                } else {
                    showTestResult('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', false);
                }
                
                console.log('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:', error);
                showTestResult(`–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, false);
            }
            
            updateLocalDataDisplay();
        }
        
        function addTestTransaction() {
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            testTransactionId = 'test_' + Date.now();
            
            const testTransaction = {
                id: testTransactionId,
                amount: -100,
                description: '–¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è',
                category: '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
                person: '–¢–µ—Å—Ç–µ—Ä',
                date: new Date().toISOString().split('T')[0],
                timestamp: Date.now(),
                type: 'expense'
            };
            
            transactions.push(testTransaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            console.log('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:', testTransactionId);
            
            // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å Firebase
            if (window.syncToFirebase) {
                window.syncToFirebase();
            }
            
            updateLocalDataDisplay();
        }
        
        async function deleteTestTransaction() {
            if (!testTransactionId) {
                console.log('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é');
                return;
            }
            
            const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
            const transaction = transactions.find(t => t.id === testTransactionId);
            
            if (!transaction) {
                console.log('‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                return;
            }
            
            console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:', testTransactionId, 'firebaseId:', transaction.firebaseId);
            
            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
            if (window.deleteTransactionFromFirebase) {
                await window.deleteTransactionFromFirebase(transaction.id, transaction.firebaseId);
                console.log('‚úÖ –ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Firebase');
            }
            
            // –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            const updatedTransactions = transactions.filter(t => t.id !== testTransactionId);
            localStorage.setItem('transactions', JSON.stringify(updatedTransactions));
            
            console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ');
            console.log('‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const deletedList = JSON.parse(localStorage.getItem('deletedTransactions') || '[]');
                console.log('üìã –°–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:', deletedList);
                
                if (deletedList.includes(testTransactionId) || deletedList.includes(transaction.firebaseId)) {
                    console.log('‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö');
                } else {
                    console.log('‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ù–ï –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–ø–∏—Å–∫–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö');
                }
            }, 2000);
            
            updateLocalDataDisplay();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            console.log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            updateLocalDataDisplay();
            
            // –ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
            setTimeout(() => {
                if (window.firebaseSync) {
                    console.log('üî• Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞');
                } else {
                    console.log('‚ö†Ô∏è Firebase —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            }, 2000);
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateLocalDataDisplay, 2000);
    </script>
</body>
</html>
</script>
</body>
</html>